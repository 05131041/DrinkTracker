<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ˜¯æœ‰å¤šæ„›å– 2026 </title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        .dreamy-gradient {
            background: linear-gradient(135deg, #FDFBFD 0%, #F8F2FC 100%);
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        input, select { font-size: 16px !important; }
        .calendar-cell { aspect-ratio: 1 / 1.3; min-height: 80px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-pop { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="dreamy-gradient min-h-screen text-[#94849A]">
    <div id="root"></div>

    <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCFnYhdOMJNAxCnVoUDxDtAItKQjURd14w",
    authDomain: "drinks-4eb2c.firebaseapp.com",
    projectId: "drinks-4eb2c",
    storageBucket: "drinks-4eb2c.firebasestorage.app",
    messagingSenderId: "394916838880",
    appId: "1:394916838880:web:ebe01d2df44542f0347f85",
    measurementId: "G-2NMHKGMR9X"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const IconBoba = ({className}) => (
            <svg className={className} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 14L22 52C22 55.3137 24.6863 58 28 58H36C39.3137 58 42 55.3137 42 52L46 14" stroke="currentColor" strokeWidth="3" strokeLinecap="round"/>
                <path d="M16 14H48" stroke="currentColor" strokeWidth="3" strokeLinecap="round"/>
                <circle cx="28" cy="48" r="2.5" fill="currentColor"/><circle cx="36" cy="46" r="2.5" fill="currentColor"/><circle cx="32" cy="52" r="2.5" fill="currentColor"/>
            </svg>
        );

        const RandomIcons = [
            (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M7 11c0-2.8 2.2-5 5-5s5 2.2 5 5c0 1.1-.4 2.1-1 3H8c-.6-.9-1-1.9-1-3zM12 14v7M9 14l3 7 3-7" /></svg>,
            (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 8h1a4 4 0 110 8h-1M3 8h14v9a4 4 0 01-4 4H7a4 4 0 01-4-4V8zM6 2v2M10 2v2" /></svg>,
            (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="7" cy="18" r="4"/><circle cx="17" cy="18" r="4"/><path d="M9 14.5c0-4 3.5-7.5 7.5-7.5M17 14.5V2" /></svg>,
            (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="9"/><circle cx="12" cy="12" r="3"/></svg>
        ];

        function App() {
            const [user, setUser] = useState(null);
            const [currentMonth, setCurrentMonth] = useState(new Date(2026, 0, 1));
            const [records, setRecords] = useState({});
            const [selectedDate, setSelectedDate] = useState(null);
            const [isModalOpen, setIsModalOpen] = useState(false);

            useEffect(() => {
                const checkFB = setInterval(() => {
                    if (window.FB) {
                        clearInterval(checkFB);
                        const { auth, onAuthStateChanged, signInAnonymously, signInWithCustomToken } = window.FB;
                        const initAuth = async () => {
                            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                await signInWithCustomToken(auth, __initial_auth_token);
                            } else { await signInAnonymously(auth); }
                        };
                        initAuth();
                        onAuthStateChanged(auth, setUser);
                    }
                }, 100);
            }, []);

            useEffect(() => {
                if (!user || !window.FB) return;
                const { db, appId, doc, onSnapshot } = window.FB;
                const docRef = doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'drinkData');
                const unsub = onSnapshot(docRef, (snap) => {
                    if (snap.exists()) setRecords(snap.data().records || {});
                });
                return () => unsub();
            }, [user]);

            const saveToCloud = async (newRecords) => {
                if (!user || !window.FB) return;
                const { db, appId, doc, setDoc } = window.FB;
                const docRef = doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'drinkData');
                await setDoc(docRef, { records: newRecords });
            };

            const formatDate = (date) => `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;

            // ç¬¬ 14 é»æ ¸å¿ƒé‚è¼¯ï¼šçµ±è¨ˆæ™‚æ’é™¤ã€Œå»¶çºŒè‡ªæ˜¨å¤©ã€çš„ç´€éŒ„
            const monthlyStats = useMemo(() => {
                const prefix = `${currentMonth.getFullYear()}-${String(currentMonth.getMonth() + 1).padStart(2, '0')}`;
                let cups = 0, cost = 0;
                const shops = {};
                
                Object.keys(records).forEach(d => {
                    if (d.startsWith(prefix)) {
                        records[d].forEach(r => {
                            // åªæœ‰éã€Œå»¶çºŒè‡ªæ˜¨å¤©ã€çš„ç´€éŒ„æ‰ç®—é€²æ¯æ•¸ (ç¬¬ 14 é»)
                            if (!r.isContinued) {
                                cups++;
                            }
                            cost += Number(r.price) || 0;
                            if (r.shopName) shops[r.shopName] = (shops[r.shopName] || 0) + 1;
                        });
                    }
                });
                const fav = Object.entries(shops).sort((a,b) => b[1]-a[1])[0]?.[0] || 'ç„¡ç´€éŒ„';
                return { cups, cost, fav };
            }, [records, currentMonth]);

            const handleSave = (dateStr, drinks) => {
                let updated = { ...records, [dateStr]: drinks };
                
                // è™•ç†ã€Œæ˜å¤©ç¹¼çºŒå–ã€é‚è¼¯
                drinks.forEach(d => {
                    if (d.continueTomorrow) {
                        const next = new Date(dateStr);
                        next.setDate(next.getDate() + 1);
                        const nStr = formatDate(next);
                        if (next.getFullYear() === 2026) {
                            const nDrinks = updated[nStr] ? [...updated[nStr]] : [];
                            const isDup = nDrinks.some(x => x.shopName === d.shopName && x.itemName === d.itemName);
                            if (!isDup && nDrinks.length < 3) {
                                // æ¨™è¨»ç‚º isContinued: true (ç¬¬ 14 é»)
                                nDrinks.push({ ...d, price: '', continueTomorrow: false, isContinued: true });
                                updated[nStr] = nDrinks;
                            }
                        }
                    }
                });
                
                setRecords(updated);
                saveToCloud(updated);
                setIsModalOpen(false);
            };

            const calendarDays = useMemo(() => {
                const year = currentMonth.getFullYear();
                const month = currentMonth.getMonth();
                const first = new Date(year, month, 1).getDay();
                const total = new Date(year, month + 1, 0).getDate();
                const days = [];
                for (let i = 0; i < first; i++) days.push(null);
                for (let d = 1; d <= total; d++) days.push(new Date(year, month, d));
                return days;
            }, [currentMonth]);

            return (
                <div className="max-w-md mx-auto min-h-screen p-2 pt-6 pb-20">
                    <div className="glass-panel rounded-[40px] shadow-2xl overflow-hidden border-4 border-white relative">
                        {/* Header */}
                        <div className="p-6 flex flex-col items-center gap-4">
                            <h1 className="text-3xl font-black text-[#B2A4B8] flex items-center gap-2 italic tracking-tighter">
                                <IconBoba className="w-10 h-10 text-[#D1C4D4]" /> å¤šæ„›å–
                            </h1>
                            
                            <div className="flex items-center gap-6 bg-white/50 px-6 py-2 rounded-full border border-white shadow-inner">
                                <button onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1))} className="w-8 h-8 text-[#B2A4B8] font-bold">ã€ˆ</button>
                                <div className="text-center min-w-[80px]">
                                    <span className="text-lg font-black text-[#94849A] block leading-none">{currentMonth.getFullYear()}</span>
                                    <span className="text-xs font-bold text-[#B2A4B8]">{currentMonth.getMonth() + 1}æœˆ</span>
                                </div>
                                <button onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1))} className="w-8 h-8 text-[#B2A4B8] font-bold">ã€‰</button>
                            </div>
                        </div>

                        {/* Stats Panel (æ‰‹æ©Ÿå„ªåŒ–) */}
                        <div className="px-6 grid grid-cols-3 gap-2 mb-6">
                            <div className="bg-[#FDE2E4]/30 p-3 rounded-2xl text-center border border-white/50">
                                <p className="text-[8px] font-bold text-[#C19EA3] uppercase tracking-tighter">æœ¬æœˆæ¯æ•¸</p>
                                <p className="text-lg font-black text-[#E5A7AF]">{monthlyStats.cups}</p>
                            </div>
                            <div className="bg-[#F3E5F5]/30 p-3 rounded-2xl text-center border border-white/50">
                                <p className="text-[8px] font-bold text-[#A696AF] uppercase tracking-tighter">æœ¬æœˆèŠ±è²»</p>
                                <p className="text-lg font-black text-[#B39DDB]">${monthlyStats.cost}</p>
                            </div>
                            <div className="bg-[#FFF9E6]/30 p-3 rounded-2xl text-center border border-white/50">
                                <p className="text-[8px] font-bold text-[#B8B89F] uppercase tracking-tighter">æœ€å¸¸å–</p>
                                <p className="text-[10px] font-black text-[#A3A38E] truncate">{monthlyStats.fav}</p>
                            </div>
                        </div>

                        {/* Calendar */}
                        <div className="px-3 pb-8 grid grid-cols-7 gap-1">
                            {['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].map(d => <div key={d} className="text-center text-[10px] font-black text-[#D1C4D4] pb-2">{d}</div>)}
                            {calendarDays.map((d, i) => {
                                if (!d) return <div key={`e-${i}`} className="h-16" />;
                                const s = formatDate(d);
                                const rs = records[s] || [];
                                const hasNewRecord = rs.some(r => !r.isContinued);
                                
                                return (
                                    <button 
                                        key={s} 
                                        onClick={() => { setSelectedDate(d); setIsModalOpen(true); }} 
                                        className={`calendar-cell rounded-2xl border border-white/40 flex flex-col items-center p-1.5 transition-all active:scale-95 ${rs.length > 0 ? (hasNewRecord ? 'bg-[#FDE2E4]/40' : 'bg-[#E2F0FB]/30') : 'bg-white/40'}`}
                                    >
                                        <span className="text-[10px] font-black text-[#B2A4B8]">{d.getDate()}</span>
                                        <div className="flex flex-wrap justify-center gap-0.5 mt-1">
                                            {rs.map((r, idx) => (
                                                <div key={idx} className={`w-1.5 h-1.5 rounded-full ${r.isContinued ? 'bg-blue-200' : 'bg-[#E5A7AF]'}`}></div>
                                            ))}
                                        </div>
                                        {/* éš¨æ©Ÿé©šå–œåœ–ç¤º (ç¬¬ 13 é») */}
                                        {rs.length > 0 && (
                                            <div className="absolute bottom-0 right-0 opacity-10">
                                                {React.createElement(RandomIcons[d.getDate() % RandomIcons.length], { className: "w-6 h-6" })}
                                            </div>
                                        )}
                                    </button>
                                );
                            })}
                        </div>
                    </div>

                    {/* Editor Modal */}
                    {isModalOpen && selectedDate && (
                        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/30 backdrop-blur-md">
                            <div className="bg-white w-full max-w-md h-[88vh] overflow-y-auto rounded-t-[40px] sm:rounded-[40px] p-6 pb-12 shadow-2xl animate-pop">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-black text-[#B2A4B8] italic">{formatDate(selectedDate)}</h2>
                                    <button onClick={() => setIsModalOpen(false)} className="w-10 h-10 rounded-full bg-[#FAF7FD] flex items-center justify-center font-bold text-[#B2A4B8]">âœ•</button>
                                </div>
                                <DrinkEditor 
                                    initialDrinks={records[formatDate(selectedDate)] || []} 
                                    onSave={(drinks) => handleSave(formatDate(selectedDate), drinks)} 
                                />
                            </div>
                        </div>
                    )}
                    
                    <div className="mt-8 text-center px-6">
                        <p className="text-[10px] font-bold text-[#B2A4B8]">ğŸ’¡ è—è‰²å°é»è¡¨ç¤ºç‚ºã€Œæ˜¨æ—¥å»¶çºŒã€ï¼Œä¸è¨ˆå…¥ç¸½æ¯æ•¸çµ±è¨ˆã€‚</p>
                    </div>
                </div>
            );
        }

        function DrinkEditor({ initialDrinks, onSave }) {
            const [drinks, setDrinks] = useState(initialDrinks);
            const add = () => drinks.length < 3 && setDrinks([...drinks, { shopName: '', itemName: '', price: '', size: 'ä¸­æ¯', ice: 'å»å†°', sugar: 'å¾®ç³–', continueTomorrow: false, isContinued: false }]);
            const up = (i, f, v) => { const n = [...drinks]; n[i][f] = v; setDrinks(n); };

            return (
                <div className="space-y-6">
                    {drinks.map((d, i) => (
                        <div key={i} className={`p-5 rounded-3xl border relative ${d.isContinued ? 'bg-[#E2F0FB]/20 border-[#E2F0FB]' : 'bg-[#FDFBFD] border-[#F8F2FC]'}`}>
                            <button onClick={() => setDrinks(drinks.filter((_, idx) => idx !== i))} className="absolute top-3 right-3 text-[#D1C4D4] p-2">âœ•</button>
                            
                            {d.isContinued && <div className="text-[8px] font-black text-[#7895B2] mb-2 tracking-widest uppercase">âœ¨ æ˜¨æ—¥æ™ºæ…§å»¶çºŒ (æœ¬æœˆä¸é‡è¦†è¨ˆæ¯)</div>}
                            
                            <div className="grid grid-cols-2 gap-3 mb-3">
                                <input className="p-3 bg-white rounded-xl border border-[#F8F2FC] font-bold text-sm" placeholder="åº—å®¶åç¨±" value={d.shopName} onChange={e => up(i, 'shopName', e.target.value)} />
                                <input className="p-3 bg-white rounded-xl border border-[#F8F2FC] font-bold text-sm" placeholder="é£²å“åç¨±" value={d.itemName} onChange={e => up(i, 'itemName', e.target.value)} />
                            </div>
                            
                            <div className="grid grid-cols-3 gap-2 mb-4">
                                <input type="number" className="p-3 bg-white rounded-xl border border-[#F8F2FC] text-sm" placeholder="NT$" value={d.price} onChange={e => up(i, 'price', e.target.value)} />
                                <select className="p-3 bg-white rounded-xl border border-[#F8F2FC] text-xs font-bold" value={d.ice} onChange={e => up(i, 'ice', e.target.value)}>
                                    {['æ­£å¸¸å†°', 'å°‘å†°', 'å¾®å†°', 'å»å†°', 'ç†±'].map(o => <option key={o}>{o}</option>)}
                                </select>
                                <select className="p-3 bg-white rounded-xl border border-[#F8F2FC] text-xs font-bold" value={d.sugar} onChange={e => up(i, 'sugar', e.target.value)}>
                                    {['æ­£å¸¸ç³–', 'åŠç³–', 'å¾®ç³–', 'ç„¡ç³–'].map(o => <option key={o}>{o}</option>)}
                                </select>
                            </div>

                            <label className="flex items-center gap-2 cursor-pointer p-3 bg-white/50 rounded-xl border border-white">
                                <input type="checkbox" className="w-4 h-4 rounded" checked={d.continueTomorrow} onChange={e => up(i, 'continueTomorrow', e.target.checked)} /> 
                                <span className="text-[11px] font-bold text-[#94849A]">æ˜å¤©ç¹¼çºŒå–</span>
                            </label>
                        </div>
                    ))}
                    
                    {drinks.length < 3 && (
                        <button onClick={add} className="w-full py-5 border-2 border-dashed border-[#D1C4D4] rounded-3xl text-[#D1C4D4] font-bold text-sm tracking-widest">+ æ–°å¢é£²å“ç´€éŒ„</button>
                    )}
                    
                    <button 
                        onClick={() => onSave(drinks)} 
                        className="w-full py-4 bg-[#FDE2E4] text-[#C19EA3] rounded-2xl font-black text-lg shadow-lg active:scale-95 transition-transform"
                    >
                        å„²å­˜ç´€éŒ„
                    </button>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
